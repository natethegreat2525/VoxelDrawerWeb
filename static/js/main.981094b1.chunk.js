(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(t,e,n){t.exports=n(17)},17:function(t,e,n){"use strict";n.r(e);var r=n(1),a=n.n(r),i=n(5),o=n.n(i),s=n(0),l=n(2),h=n(3),u=n(8);function c(t,e,n){return function(n,r,a){return n+r*t+a*t*e}}function f(t,e,n,r,a,i){var o=[[0,0],[1,0],[1,1],[0,1]],l=function(e,n,l){var h,c=t.vertices.length;(h=t.vertices).push.apply(h,Object(u.a)(o.map(e)));for(var f=new s.c(a),v=new s.c(a),d=new s.c(a),y=new s.c(a),m=new s.c("#000000"),p=new Array(4).fill(0),x=0,k=0;k<2;k++)for(var z=0;z<2;z++){for(var g=0,w=k;w<k+2;w++)for(var b=z;b<z+2;b++){var C=w,M=b,E=l+1;if(-1===l){var P=C;C=M,M=P}if(1===n){var O=C;C=M,M=E,E=O}if(0===n){var S=C;C=E,E=M,M=S}g+=r[i(E,M,C)]}p[x]=1-g/4,x++}f.lerp(m,p[0]),v.lerp(m,p[2]),d.lerp(m,p[3]),y.lerp(m,p[1]),p[0]+p[3]<p[2]+p[1]?(t.faces.push(new s.e(c,c+1,c+2),new s.e(c,c+2,c+3)),t.faces[t.faces.length-1].vertexColors=[f,d,y],t.faces[t.faces.length-2].vertexColors=[f,v,d]):(t.faces.push(new s.e(c,c+1,c+3),new s.e(c+1,c+2,c+3)),t.faces[t.faces.length-1].vertexColors=[v,d,y],t.faces[t.faces.length-2].vertexColors=[f,v,y])};n[0]&&l(function(t){return new s.m(t[1],t[0],0).add(e)},2,-1),n[1]&&l(function(t){return new s.m(t[0],t[1],1).add(e)},2,1),n[2]&&l(function(t){return new s.m(t[0],0,t[1]).add(e)},1,-1),n[3]&&l(function(t){return new s.m(t[1],1,t[0]).add(e)},1,1),n[4]&&l(function(t){return new s.m(0,t[1],t[0]).add(e)},0,-1),n[5]&&l(function(t){return new s.m(1,t[0],t[1]).add(e)},0,1)}var v=function t(e,n,r){Object(l.a)(this,t),this.prev=n,this.next=r,this.value=e},d=function(){function t(){Object(l.a)(this,t),this.start=null,this.end=null,this.len=0}return Object(h.a)(t,[{key:"push",value:function(t){if(this.len++,!this.end)return this.start=new v(t),void(this.end=this.start);var e=new v(t,this.end);this.end.next=e,this.end=e}},{key:"pop",value:function(t){if(this.end){var e=this.end;return this.remove(e),t?e:e.value}}},{key:"peekLast",value:function(t){if(this.end)return t?this.end:this.end.value}},{key:"peekFirst",value:function(t){if(this.start)return t?this.start:this.start.value}},{key:"unshift",value:function(t){if(this.len++,!this.start)return this.end=new v(t),void(this.start=this.end);var e=new v(t,void 0,this.start);this.start.prev=e,this.start=e}},{key:"shift",value:function(t){if(this.start){var e=this.start;return this.remove(e),t?e:e.value}}},{key:"remove",value:function(t){t.prev?t.prev.next=t.next:this.start=t.next,t.next?t.next.prev=t.prev:this.end=t.prev,this.len--}}]),t}(),y=[null,new s.c(6710886)];function m(t,e){var n=t%e;return n<0&&(n+=e),n}var p=function(){function t(e){Object(l.a)(this,t),this.capacity=e||2e3,this.cache=new d,this.map={},this.heightMap={}}return Object(h.a)(t,[{key:"addChunk",value:function(t){var e=this.coordToString(t.pos);if(this.map[e])return this.map[e].value=t,this.getChunk(t.pos),void this.updateHeightsForChunk(t);this.cache.unshift(t),this.updateHeightsForChunk(t),this.map[this.coordToString(t.pos)]=this.cache.peekFirst(!0),this.cache.len>this.capacity&&delete this.map[this.coordToString(this.cache.pop().pos)]}},{key:"updateHeightsForChunk",value:function(t){var e=this.heightMap[t.pos.x+","+t.pos.z];e||(e=new Uint16Array(x*x),this.heightMap[t.pos.x+","+t.pos.z]=e);for(var n=0;n<x;n++)for(var r=0;r<x;r++)for(var a=0;a<x;a++)t.data[n+r*x+a*x*x]&&(e[n+a*x]=Math.max(e[n+a*x],r+t.pos.y*x))}},{key:"getHeight",value:function(t,e){var n=new s.m(m(Math.floor(t),x),0,m(Math.floor(e),x)),r=Math.floor(t/x),a=Math.floor(e/x),i=this.heightMap[r+","+a];if(i)return i[n.x+n.z*x]}},{key:"getBlockValue",value:function(t){var e=new s.m(m(Math.floor(t.x),x),m(Math.floor(t.y),x),m(Math.floor(t.z),x)),n={x:Math.floor(t.x/x),y:Math.floor(t.y/x),z:Math.floor(t.z/x)},r=this.getChunk(n);if(r)return r.data[e.x+e.y*x+e.z*x*x]}},{key:"setBlockValue",value:function(t,e,n){var r=new s.m(m(Math.floor(t.x),x),m(Math.floor(t.y),x),m(Math.floor(t.z),x)),a={x:Math.floor(t.x/x),y:Math.floor(t.y/x),z:Math.floor(t.z/x)},i=this.getChunk(a);if(!i){if(!n)return;i=new k(new s.m(a.x,a.y,a.z)),this.addChunk(i)}var o=r.x+r.y*x+r.z*x*x,l=this.heightMap[a.x+","+a.z];if(!i.data[o]&&e&&(l[r.x+r.z*x]=Math.max(l[r.x+r.z*x],t.y)),i.data[o]&&!e&&t.y===l[r.x+r.z*x])for(var h=t.y-1;h>=0&&(l[r.x+r.z*x]=h,!this.getBlockValue(new s.m(t.x,h,t.z)));h--);if(i.data[o]=e,i.dirty=!0,0===r.x){var u=this.getChunk({x:a.x-1,y:a.y,z:a.z});u&&(u.dirty=!0)}if(0===r.y){var c=this.getChunk({x:a.x,y:a.y-1,z:a.z});c&&(c.dirty=!0)}if(0===r.z){var f=this.getChunk({x:a.x,y:a.y,z:a.z-1});f&&(f.dirty=!0)}if(r.x===x-1){var v=this.getChunk({x:a.x+1,y:a.y,z:a.z});v&&(v.dirty=!0)}if(r.y===x-1){var d=this.getChunk({x:a.x,y:a.y+1,z:a.z});d&&(d.dirty=!0)}if(r.z===x-1){var y=this.getChunk({x:a.x,y:a.y,z:a.z+1});y&&(y.dirty=!0)}}},{key:"rayCastOld",value:function(t,e,n,r){for(var a=new s.m(t.x,t.y,t.z),i=e.clone().normalize().multiplyScalar(n),o=0;o<=r;o++){var l=new s.m(Math.floor(a.x),Math.floor(a.y),Math.floor(a.z)),h=this.getBlockValue(l);if(h)return{position:a,blockPosition:l,value:h};a=a.add(i)}}},{key:"rayCast",value:function(t,e,n){var r,a,i,o={x:Math.floor(t.x),y:Math.floor(t.y),z:Math.floor(t.z)},l=e.x>0?1:-1,h=e.y>0?1:-1,u=e.z>0?1:-1,c=t.clone();r=e.x>0?function(){return 0===e.x?1/0:(o.x+1-c.x)/e.x}:function(){return 0===e.x?1/0:(o.x-c.x)/e.x},a=e.y>0?function(){return 0===e.y?1/0:(o.y+1-c.y)/e.y}:function(){return 0===e.y?1/0:(o.y-c.y)/e.y},i=e.z>0?function(){return 0===e.z?1/0:(o.z+1-c.z)/e.z}:function(){return 0===e.z?1/0:(o.z-c.z)/e.z};for(var f=function(t){c.x+=e.x*t,c.y+=e.y*t,c.z+=e.z*t},v=new s.m,d=0;d<3*n;d++){var y=this.getBlockValue(o);if(y)return c.distanceTo(t)<=n?{position:c,blockPosition:o,value:y,normal:v}:null;var m=r(),p=a(),x=i();m<p&&m<x?(f(m),o.x+=l,v=new s.m(-l,0,0)):p<x?(f(p),o.y+=h,v=new s.m(0,-h,0)):(f(x),o.z+=u,v=new s.m(0,0,-u))}return null}},{key:"getChunk",value:function(t){var e=this.coordToString(t),n=this.map[e];if(n){this.cache.remove(n),this.cache.unshift(n.value);var r=this.cache.peekFirst(!0);return this.map[e]=r,r.value}return null}},{key:"coordToString",value:function(t){return t.x+","+t.y+","+t.z}}]),t}(),x=16,k=function t(e){Object(l.a)(this,t),this.pos=e,this.dirty=!0,this.data=new Uint16Array(x*x*x)},z=function(){function t(e){Object(l.a)(this,t),this.size=e,this.offset=new s.m(0,0,0),this.chunks=new Array(this.size.x*this.size.y*this.size.z)}return Object(h.a)(t,[{key:"rebuildDirty",value:function(t,e,n){var r=0;n=n||1/0;for(var a=0;a<this.size.x;a++)for(var i=0;i<this.size.y;i++)for(var o=0;o<this.size.z;o++){var l=new s.m(a+this.offset.x,i+this.offset.y,o+this.offset.z),h=t.getChunk(l);if(h&&h.dirty){var u=a+i*this.size.x+o*this.size.x*this.size.y;if(this.chunks[u]&&(e.remove(this.chunks[u]),this.chunks[u].geometry.dispose(),this.chunks[u].material.dispose()),this.chunks[u]=this.buildChunk(t,l),this.chunks[u].position.x=l.x*x-1,this.chunks[u].position.y=l.y*x-1,this.chunks[u].position.z=l.z*x-1,h.dirty=!1,e.add(this.chunks[u]),++r>=n)return}}}},{key:"fill",value:function(t,e){for(var n=0;n<this.size.x;n++)for(var r=0;r<this.size.y;r++)for(var a=0;a<this.size.z;a++)e.addChunk(t.getChunk(new s.m(n+this.offset.x,r+this.offset.y,a+this.offset.z)));for(var i=0;i<this.size.x;i++)for(var o=0;o<this.size.y;o++)for(var l=0;l<this.size.z;l++){var h=new s.m(i+this.offset.x,o+this.offset.y,l+this.offset.z);if(e.getChunk(h)){var u=i+o*this.size.x+l*this.size.x*this.size.y;this.chunks[u]=this.buildChunk(e,h),this.chunks[u].position.x=h.x*x-1,this.chunks[u].position.y=h.y*x-1,this.chunks[u].position.z=h.z*x-1}}}},{key:"addToScene",value:function(t){for(var e=0;e<this.chunks.length;e++)t.add(this.chunks[e])}},{key:"buildChunk",value:function(t,e){var n=t.getChunk(e);n&&(n.dirty=!1);for(var r=x+2,a=new Array(r*r*r),i=new Array(r*r*r),o=e.clone().multiplyScalar(x),l=o.x-1;l<o.x+x+1;l++)for(var h=l-o.x+1,u=o.y-1;u<o.y+x+1;u++)for(var v=u-o.y+1,d=o.z-1;d<o.z+x+1;d++){var p=d-o.z+1,k=1,z=Math.floor(l/x),g=Math.floor(u/x),w=Math.floor(d/x),b=t.getChunk(new s.m(z,g,w));b&&(k=b.data[m(l,x)+m(u,x)*x+m(d,x)*x*x]);var C=h+v*r+p*r*r;a[C]=y[k],k?i[C]=0:u>=t.getHeight(l,d)?i[C]=1:i[C]=.5}return function(t,e,n,r,a){var i=c(e,n),o=c(3,3);if(!a){a=new Array(e*n*r);for(var l=0;l<e;l++)for(var h=0;h<n;h++)for(var u=0;u<r;u++)a[i(l,h,u)]=t[i(l,h,u)]?0:1}for(var v=new s.f,d=1;d<e-1;d++)for(var y=1;y<n-1;y++)for(var m=1;m<r-1;m++)if(t[i(d,y,m)]){for(var p=[],x=-1;x<2;x++)for(var k=-1;k<2;k++)for(var z=-1;z<2;z++)p.push(a[i(d+x,y+k,m+z)]);f(v,new s.m(d,y,m),[!t[i(d,y,m-1)],!t[i(d,y,m+1)],!t[i(d,y-1,m)],!t[i(d,y+1,m)],!t[i(d-1,y,m)],!t[i(d+1,y,m)]],p,t[i(d,y,m)],o)}v.computeFaceNormals();var g=new s.h({vertexColors:s.n});return new s.g(v,g)}(a,x+2,x+2,x+2,i)}}]),t}(),g=null,w=0,b=0,C=null,M=!1,E=null,P=null,O=null,S=null,B=10,j=10,V=10,A=0,F=Math.PI/8,L=0,T=0,I=null,W=null,H=1,q=20,D=null,U=null;function Y(t){t;var e=new s.m((2+B)/2,1,(2+j)/2),n=new s.m(Math.sin(A)*Math.cos(F)*q,Math.sin(F)*q,Math.cos(A)*Math.cos(F)*q),r=e.add(n);P.position.set(r.x,r.y,r.z),P.rotation.y=A,P.children[0].rotation.x=-F;var a=new s.m(L/w*2-1,-T/b*2+1,.5),i=(a=a.clone().unproject(P.children[0])).sub(P.position),o=S.rayCast(P.position,i,50);o?(I.position.set(o.position.x,o.position.y,o.position.z),D.position.set(o.blockPosition.x+o.normal.x+.5,o.blockPosition.y+o.normal.y+.5,o.blockPosition.z+o.normal.z+.5)):(I.position.set(1e3,1e3,1e3),D.position.set(1e3,1e3,1e3)),W=o,O.rebuildDirty(S,E,0),O.newlyLoaded=!1,C.render(E,P.children[0]),requestAnimationFrame(Y)}function J(){var t={w:B,h:V,d:j};t.v=new Array(B*V*j);for(var e=0,n=0;n<j;n++)for(var r=0;r<V;r++)for(var a=0;a<B;a++)t.v[e]=S.getBlockValue({x:a+1,y:r+2,z:n+1}),e++;t.c=[];for(var i=2;i<y.length;i++)t.c.push({r:y[i].r,g:y[i].g,b:y[i].b});return t}function R(t,e,n){for(var r=0;r<B;r++)for(var a=-1;a<V;a++)for(var i=0;i<j;i++)(r>=t||a>=e||i>=n)&&S.setBlockValue({x:r+1,y:a+2,z:i+1},0,!0);B=t,V=e,j=n;for(var o=0;o<t;o++)for(var s=0;s<n;s++)S.setBlockValue({x:o+1,y:1,z:s+1},1,!0)}var N=n(6),X=n(9),G=n(7),_=n(10),K=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(X.a)(this,Object(G.a)(e).call(this,t))).state={r:0,g:0,b:0,colors:[],selected:0,w:10,h:10,d:10},n}return Object(_.a)(e,t),Object(h.a)(e,[{key:"componentWillMount",value:function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++)for(var n=0;n<4;n++)this.addColor(Math.floor(255*Math.sqrt(t/3)),Math.floor(255*Math.sqrt(e/3)),Math.floor(255*Math.sqrt(n/3)));this.clickColor(0)}},{key:"setColor",value:function(t){var e=this;return function(n){e.setState(Object(N.a)({},t,parseInt((n.target.value||0)+"")))}}},{key:"addColor",value:function(t,e,n){var r=this;"undefined"===typeof t&&(t=this.state.r,e=this.state.g,n=this.state.b);var a=this.state.colors;a.push({r:t,g:e,b:n}),this.props.addColor&&this.props.addColor(a[a.length-1]),this.setState({colors:a},function(){r.clickColor(a.length-1)()})}},{key:"clickColor",value:function(t){var e=this;return function(){e.props.selectColor&&e.props.selectColor(t),e.setState({r:e.state.colors[t].r,g:e.state.colors[t].g,b:e.state.colors[t].b,selected:t})}}},{key:"onSave",value:function(){this.setState({textValue:JSON.stringify(J())})}},{key:"onLoad",value:function(){var t=JSON.parse(this.state.textValue);t&&(!function(t){R(t.w,t.h,t.d);for(var e=0,n=0;n<j;n++)for(var r=0;r<V;r++)for(var a=0;a<B;a++)S.setBlockValue({x:a+1,y:r+2,z:n+1},t.v[e],!0),e++;for(var i=0;i<t.c.length;i++)y[i+2]=new s.c(t.c[i].r,t.c[i].g,t.c[i].b)}(t),this.setState({w:t.w,h:t.h,d:t.d,colors:t.c.map(function(t){return{r:255*t.r,g:255*t.g,b:255*t.b}})}),this.clickColor(0)())}},{key:"onTextUpdated",value:function(t){this.setState({textValue:t.target.value})}},{key:"onCopy",value:function(){document.getElementById("textInput").select(),document.execCommand("copy")}},{key:"resize",value:function(){this.props.resize&&this.props.resize(this.state.w,this.state.h,this.state.d)}},{key:"getPallette",value:function(){var t=this;return this.state.colors.map(function(e,n){var r={padding:0,margin:1,borderWidth:0,width:20,height:20,background:"rgb("+e.r+", "+e.g+", "+e.b+")"};return n===t.state.selected&&(r.borderWidth="3px",r.borderStyle="solid",r.borderColor="black"),a.a.createElement("button",{key:n,onClick:t.clickColor(n),style:r})})}},{key:"render",value:function(){var t=this;return a.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.a.createElement("div",null,a.a.createElement("div",{style:{padding:5}},a.a.createElement("div",null,a.a.createElement("button",{style:{padding:0,borderWidth:0,width:40,height:40,background:"rgb("+this.state.r+", "+this.state.g+", "+this.state.b+")"}})),a.a.createElement("div",null,"R: ",a.a.createElement("input",{type:"number",value:this.state.r,onChange:this.setColor("r")})),a.a.createElement("div",null,"G: ",a.a.createElement("input",{type:"number",value:this.state.g,onChange:this.setColor("g")})),a.a.createElement("div",null,"B: ",a.a.createElement("input",{type:"number",value:this.state.b,onChange:this.setColor("b")})),a.a.createElement("div",null,a.a.createElement("button",{onClick:function(){return t.addColor()}},"+"))),a.a.createElement("div",{style:{padding:5,maxWidth:370}},this.getPallette()),a.a.createElement("div",{style:{padding:5}},a.a.createElement("button",{style:{margin:5},onClick:function(){return t.onSave()}},"Save"),a.a.createElement("button",{style:{margin:5},onClick:function(){return t.onLoad()}},"Load"),a.a.createElement("button",{style:{margin:5},onClick:function(){return t.onCopy()}},"Copy")),a.a.createElement("div",{style:{padding:10}},a.a.createElement("textarea",{id:"textInput",value:this.state.textValue,onChange:function(e){return t.onTextUpdated(e)}}))),a.a.createElement("div",null,a.a.createElement("div",{style:{padding:5}},a.a.createElement("div",null,"W: ",a.a.createElement("input",{type:"number",value:this.state.w,onChange:this.setColor("w")})),a.a.createElement("div",null,"H: ",a.a.createElement("input",{type:"number",value:this.state.h,onChange:this.setColor("h")})),a.a.createElement("div",null,"D: ",a.a.createElement("input",{type:"number",value:this.state.d,onChange:this.setColor("d")})),a.a.createElement("button",{style:{margin:5},onClick:function(){return t.resize()}},"Resize"))))}}]),e}(a.a.Component),Q=document.getElementById("canvas");document.body.setAttribute("style","margin: 0px");var Z=document.getElementById("root");o.a.render(a.a.createElement(K,{selectColor:function(t){H=t+2},addColor:function(t){y.push(new s.c(t.r/255,t.g/255,t.b/255))},resize:R}),Z),function(){Q.width=800,Q.height=600;var t=Q.getContext("webgl");t?(t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),function(t,e,n,r){if(console.log("init"),g=t,e,w=n,b=r,(C=new s.o({canvas:g})).setClearColor(12509183),M)return P.children[0].aspect=w/b,void P.children[0].updateProjectionMatrix();var a=!1,i=!1;t.oncontextmenu=function(t){if(!i&&W){var e=new s.m(W.blockPosition.x,W.blockPosition.y,W.blockPosition.z);e.x>=1&&e.x<1+B&&e.y>=2&&e.y<2+V&&e.z>=1&&e.z<1+j&&S.setBlockValue(new s.m(e.x,e.y,e.z),0,!0)}t.preventDefault()},t.addEventListener("mousemove",function(t){a&&!U&&(A-=.005*t.movementX,F+=.005*t.movementY,(Math.abs(t.movementX)>1||Math.abs(t.movementY)>1)&&(i=!0)),L=t.offsetX,T=t.offsetY}),t.addEventListener("mousedown",function(t){1===t.button&&(U=W),a=!0,i=!1}),t.addEventListener("mouseup",function(t){if(a=!1,!i&&0===t.button&&W){var e=new s.m(W.blockPosition.x,W.blockPosition.y,W.blockPosition.z).add(W.normal);e.x>=1&&e.x<1+B&&e.y>=2&&e.y<2+V&&e.z>=1&&e.z<1+j&&S.setBlockValue(new s.m(e.x,e.y,e.z),H,!0)}if(1===t.button&&U&&W){var n=new s.m(U.blockPosition.x,U.blockPosition.y,U.blockPosition.z),r=new s.m(W.blockPosition.x,W.blockPosition.y,W.blockPosition.z);if(n.x>=1&&n.x<1+B&&n.y>=2&&n.y<2+V&&n.z>=1&&n.z<1+j&&r.x>=1&&r.x<1+B&&r.y>=2&&r.y<2+V&&r.z>=1&&r.z<1+j){var o=Math.min(n.x,r.x),l=Math.min(n.y,r.y),h=Math.min(n.z,r.z),u=Math.max(n.x,r.x),c=Math.max(n.y,r.y),f=Math.max(n.z,r.z);n.x=o,n.y=l,n.z=h,r.x=u,r.y=c,r.z=f;for(var v=n.x;v<=r.x;v++)for(var d=n.y;d<=r.y;d++)for(var y=n.z;y<=r.z;y++)S.setBlockValue(new s.m(v,d,y),H,!0)}}U=null}),t.addEventListener("wheel",function(t){t.deltaY>0&&(q*=1.05),t.deltaY<0&&(q*=.95)}),M=!0;var o=new s.j(50,w/b,.1,300);(P=new s.i).add(o),P.position.set(0,0,10),(E=new s.k).add(P);var l=new s.d(16777215,1);E.add(l);var h=new s.a(16777215,.5);E.add(h),(I=new s.l).scale(.1,.1,.1);var u=new s.h({color:16711680});I=new s.g(I,u),E.add(I),D=new s.b(1,1,1),u=new s.h({color:10066431,transparent:!0,opacity:.3}),D=new s.g(D,u),E.add(D),O=new z(new s.m(3,3,3)),S=new p,O.offset=new s.m(0,0,0);for(var c=0;c<B;c++)for(var f=0;f<j;f++)S.setBlockValue(new s.m(1+c,1,1+f),1,!0);requestAnimationFrame(Y)}(Q,t,Q.width,Q.height)):alert("WebGL not available.")}()}},[[11,1,2]]]);
//# sourceMappingURL=main.981094b1.chunk.js.map